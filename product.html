<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Product Details</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <header class="main-header">
        <div class="main-header__inner">
            <div class="logo">UniCloth</div>
            <nav class="nav-links">
                <a href="index.html">Home</a>
                <a href="new-in.html">New In</a>
                <a href="best-seller.html">Best Seller</a>
            </nav>
        </div>
    </header>

    <main class="wrapper product-page">
        <a href="new-in.html" class="back-link">← Back to products</a>

        <section class="product-detail">
            <div class="product-detail__media">
                <img id="pd-image" src="" alt="" />
            </div>

            <div class="product-detail__info">
                <h1 id="pd-title">Product Title</h1>
                <div class="price-row">
                    <span id="pd-old" class="old-price"></span>
                    <span id="pd-new" class="new-price"></span>
                </div>

                <p id="pd-desc">Product description will appear here.</p>

                <div id="pd-sizes" class="sizes"></div>

                <div class="product-actions">
                    <select id="size-select" aria-label="Select size">
                        <option value="">Select size</option>
                    </select>
                    <button id="add-cart" class="primary-btn">Add to Cart</button>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="wrapper footer-inner">
            <p class="footer-copy">Copyright © 2025 Topu | Proudly Made in Bangladesh</p>
        </div>
    </footer>

    <script>
        function renderProduct(prod){
            if(!prod) return;
            document.title = prod.title + ' - UniCloth';
            var img = document.getElementById('pd-image');
            img.src = prod.image || '';
            img.alt = prod.alt || prod.title || '';
            document.getElementById('pd-title').textContent = prod.title || '';
            document.getElementById('pd-old').textContent = prod.oldPrice || '';
            document.getElementById('pd-new').textContent = prod.newPrice || '';
            document.getElementById('pd-desc').textContent = prod.description || '';

            var sizesContainer = document.getElementById('pd-sizes');
            var sizeSelect = document.getElementById('size-select');
            sizesContainer.innerHTML = '';
            sizeSelect.innerHTML = '<option value="">Select size</option>';
            if(Array.isArray(prod.sizes)){
                prod.sizes.forEach(function(s){
                    var btn = document.createElement('button');
                    btn.className = 'size-btn';
                    btn.type = 'button';
                    btn.textContent = s;
                    btn.addEventListener('click', function(){ sizeSelect.value = s; });
                    sizesContainer.appendChild(btn);

                    var opt = document.createElement('option');
                    opt.value = s; opt.textContent = s;
                    sizeSelect.appendChild(opt);
                });
            }

            document.getElementById('add-cart').addEventListener('click', function(){
                var sel = document.getElementById('size-select').value;
                if(!sel){ alert('Please select a size'); return; }
                var toAdd = Object.assign({}, prod);
                toAdd.size = sel;
                toAdd.qty = 1;
                if(window.addToCart){
                    try{ addToCart(toAdd); }catch(e){ console.error(e); }
                } else {
                    // fallback
                    try{
                        var cart = localStorage.getItem('cart'); cart = cart ? JSON.parse(cart) : [];
                        var ex = cart.find(function(c){ return c.id===toAdd.id && c.size===toAdd.size; });
                        if(ex) ex.qty = (ex.qty||0) + 1; else cart.push(toAdd);
                        localStorage.setItem('cart', JSON.stringify(cart));
                    }catch(e){ console.error(e); }
                }
                // also attempt server save for logged-in users
                fetch('save_cart.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'same-origin',
                    body: JSON.stringify({ product_id: toAdd.id, title: toAdd.title, image: toAdd.image, size: toAdd.size, qty: toAdd.qty, price: toAdd.newPrice })
                }).then(function(res){
                    if(res.ok) return res.json();
                    return res.json().catch(function(){ return null; });
                }).then(function(json){
                    // ignore errors — localStorage still works for guests
                }).catch(function(){ /* ignore */ });

                if(window.updateCartCount) updateCartCount();
                // after adding, open cart page
                window.location.href = 'cart.html';
            });
        }

        (function(){
            var raw = localStorage.getItem('selectedProduct');
            var prod = null;
            try{ prod = raw ? JSON.parse(raw) : null; }catch(e){ prod = null; }
            if(prod){
                renderProduct(prod);
            } else {
                // No product in localStorage — show fallback
                document.getElementById('pd-title').textContent = 'No product selected';
                document.getElementById('pd-desc').textContent = 'Please select a product from the listing.';
            }
        })();
    </script>
</body>

</html>
